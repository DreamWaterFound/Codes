# 048 CMake Advanced

对一些需要用到的 cmake 高级用法的测试。

- `add_custom_command`
  
  可以在cmake阶段通过调用命令来实现一些额外的操作。我想要做的是能够将某些由*.in生成的头文件复制到一个指定的文件夹中来让我的程序进行包含，但是发现只有写成：
  ```
  add_custom_command(TARGET target POST_BUILD .... )
  ```
  这样的方式才可以达到我的预期，而最开始我所尝试的：
  ```
  add_custom_command(OUTPUT file .... )
  ```
  却总是得不到执行，不知道原因是什么。

- `file(COPY ....)`

  可以使用file命令复制文件，达到和上面的命令完全相同的效果。不同的是这个是在cmake阶段就完成，上者则是在make阶段完成，并且上者还可以指定是在构建目标前还是构建目标后再执行。

  发现一个问题就是如果我希望将一个文件复制到另外一个地方并且添加可执行权限的话，只要有添加权限的操作，最终会在目标文件夹生成对应的文件，但是文件的权限不会被正确设置，而且文件的内容也会丢失（就只能够得到一个空的文件）。

- `file(GLOB_RECURSE .....)`

  使用这个命令可以递归搜索某个目录中的文件，可以方便地搜集源程序目录下的所有文件，就不需要自己重新修改`CMakeLists.txt`了。

  类似的命令还有`aux_source_directory`。不过这两种方式都有一个共同的问题，如果cmake之后原来的工程中的源文件有修改的话，必须得重新cmake一下才可以。

- `file(WRITE ... )`

  这个是可以直接使用cmake来写入目标文件，例如可以生成我喜欢用的一键运行的脚本。



